<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Changemaker Dost - Chatbot Demo</title>
    <!-- Google Fonts for a cleaner look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f8f9fa; /* Softer background color */
            color: #212529;
            text-align: center;
        }
        .container {
            max-width: 600px;
            padding: 2rem;
        }
        h1 {
            font-size: 3rem;
            font-weight: 700;
            color: #0d6efd; /* A vibrant blue */
            margin-bottom: 1rem;
        }
        p {
            font-size: 1.15rem;
            line-height: 1.7;
            color: #495057;
            margin-bottom: 2rem;
        }
        .footer {
            position: absolute;
            bottom: 15px;
            font-size: 0.9rem;
            color: #6c757d;
        }
        /* Styling for the Dialogflow widget */
        df-messenger {
          --df-messenger-bot-message: #f8f9fa;
          --df-messenger-button-titlebar-color: #0d6efd;
          --df-messenger-font-color: #212529;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Changemaker Dost</h1>
        <p>Your AI-powered companion to strengthen changemaking skills and increase youth employability. Click the chat icon to begin.</p>
    </div>

    <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
    <df-messenger
      chat-title="Changemaker Dost"
      agent-id="37266707-5fe3-47f1-af94-aeb4f3768cf1"
      language-code="en"
      location="asia-south1"
      expand="true"
    ></df-messenger>

    <div class="footer">
        <p>Powered by Dialogflow and Google AI</p>
    </div>

    <!-- This script provides full control over the welcome experience, styling, AND persistent user ID -->
    <script>
      const dfMessenger = document.querySelector('df-messenger');

      // Function to get or create a persistent user ID from browser's local storage
      function getOrCreateUserId() {
          let userId = localStorage.getItem('changemakerDost_userId');
          if (!userId) {
              // If no ID exists, create a new one (a simple random string)
              userId = 'user_' + Math.random().toString(36).substring(2, 15);
              localStorage.setItem('changemakerDost_userId', userId);
          }
          return userId;
      }

      // This event fires once the Dialogflow Messenger widget is ready
      dfMessenger.addEventListener('df-messenger-loaded', function (event) {
        
        // --- NEW: Set the persistent session ID ---
        const persistentUserId = getOrCreateUserId();
        dfMessenger.setAttribute('session-id', persistentUserId);
        console.log('Persistent User ID set:', persistentUserId);
        
        // --- Existing: Define the payload for the welcome card ---
        const welcomePayload = [
            {
              "type": "info",
              "title": "Iâ€™m your Changemaker Dost.",
              "subtitle": "You can ask me anything about Ashoka, or we can start your CMI assessment.",
            },
            {
              "type": "chips",
              "options": [
                {
                  "text": "Want to know about Ashoka young changemakers"
                },
                {
                  "text": "Start CMI assessment"
                }
              ]
            }
          ];
        
        // Use renderCustomCard to display our welcome message in a card
        dfMessenger.renderCustomCard(welcomePayload);

        // --- Existing: Apply custom styling ---
        try {
            const chatWrapper = dfMessenger.shadowRoot.querySelector('df-messenger-chat');
            const style = document.createElement('style');

            style.textContent = `
                /* Removes the border from the header */
                .header {
                    border: none !important;
                }
                /* This targets the message list and pushes the first card up */
                #messageList .message-list-wrapper {
                    justify-content: flex-start; /* Aligns items to the top */
                    padding-top: 25%; /* Pushes the card down from the top */
                }
            `;

            chatWrapper.shadowRoot.appendChild(style);

        } catch(e) {
            console.error("Could not apply custom styles:", e);
        }
      });
    </script>

</body>
</html>
